<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HHC5D43J97"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-HHC5D43J97",{anonymize_ip:!0})</script><title data-react-helmet="true">2021-08-13 - Blank Screen because of incompatible Local Storage Schema | Felvin Search Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.felvin.com/incident-reports/2021-08-13-localstorage-schema-error"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="2021-08-13 - Blank Screen because of incompatible Local Storage Schema | Felvin Search Documentation"><meta data-react-helmet="true" name="description" content="Date: 13 August, 2021"><meta data-react-helmet="true" property="og:description" content="Date: 13 August, 2021"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.felvin.com/incident-reports/2021-08-13-localstorage-schema-error"><link data-react-helmet="true" rel="alternate" href="https://docs.felvin.com/incident-reports/2021-08-13-localstorage-schema-error" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.felvin.com/incident-reports/2021-08-13-localstorage-schema-error" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0c1eb2ef.css">
<link rel="preload" href="/assets/js/runtime~main.faae58a7.js" as="script">
<link rel="preload" href="/assets/js/main.25343b50.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/favicon-32x32.png" alt="Felvin Search logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/favicon-32x32.png" alt="Felvin Search logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Felvin Search</b></a><a class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a href="https://blog.felvin.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://felvin.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>felvin.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Features</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/overview">Instant Apps</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/profiles/overview">Profiles</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Instant Apps</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/marketplace">Marketplace</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Company</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/about-us">About us</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/vision">Vision</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/mission">Mission</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/careers">Careers</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Events</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/events/hackathon">Instant Apps Hackathon</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Team Docs</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/team-documentation">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/team-docs/tutorials">Tutorial</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Decisions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Processes</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">RFCs</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">felvin.com</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Incident Reports</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/incident-reports/2021-08-13-localstorage-schema-error">2021-08-13 - Blank Screen because of incompatible Local Storage Schema</a></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>2021-08-13 - Blank Screen because of incompatible Local Storage Schema</h1></header><p><em>Date: 13 August, 2021</em></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="what-was-the-problem"></a>What was the problem?<a class="hash-link" href="#what-was-the-problem" title="Direct link to heading">#</a></h2><p>A user who has not opened for long ago, reopened the website and noticed a blank screen with the following errors in the console.</p><p><img src="https://i.imgur.com/0Zo9Com.png" alt="Error in console"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="why-did-it-happen"></a>Why did it happen?<a class="hash-link" href="#why-did-it-happen" title="Direct link to heading">#</a></h2><p><a href="https://github.com/Neera-AI/neera/commit/bf53ca0bf9ec97809dde5694541f4c9b1ee0b417" target="_blank" rel="noopener noreferrer">Till mid May 2021</a>, we used to store <code>profile</code> in the local storage with schema <code>[&lt;profile 1&gt;, &lt;profile 2&gt;]</code>. Then we removed using local storage and fetched all the profiles from DB. Though profiles didn&#x27;t change often, so optimize website load time with <a href="https://blog.neera.ai/2021/07/22/v1-27-0-autocorrect-faster-results-and-a-basic-image-search/" target="_blank" rel="noopener noreferrer">v1.27.0</a> we re-introduced local storage. This time the schema was different and looked like <code>{list:[&lt;profile 1&gt;, &lt;profile 2&gt;]}</code>.</p><p>If a person had Local Storage schema stored as per old schema, and then they open it now, it would cause error as the latest code expects a different Schema. This precisely happened with one of the users. The user had opened the site once long back, and never used the site later. But when the user was trying to access the site recently, an error triggered preventing the page from loading.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="how-did-we-fix-it"></a>How did we fix it?<a class="hash-link" href="#how-did-we-fix-it" title="Direct link to heading">#</a></h2><p>We changed the key name of the profiles from <code>profile</code> to <code>profile_v2021_08_13</code>. When a user opens a page, it tries to find profiles from the Local Storage with the new key name - <code>profile_v2021_08_13</code>, since it doesn&#x27;t exist in any of the users till now. It will fetch the profiles from database as per the latest schema and the latest schema will be used by all the users from now on, irrespective of when they had opened our site in the past.</p><p>The date was included in the key name so that it is easier to recollect an explanation for the change. It will be easier to identify schema of the value as per versions in future. Hence, we can avoid the problem of having different data schemas for same key name.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="lessons-and-thoughts"></a>Lessons and thoughts<a class="hash-link" href="#lessons-and-thoughts" title="Direct link to heading">#</a></h2><ul><li>Cookies are better because, one can set an expiry date and new ones can be used.</li><li>Do not rely on Local Storage heavily. It&#x27;s difficult to change the values. Sometimes to fix the bugs, you may have to do dirty hacks, which compromise code quality.</li></ul><p>The other ideas that were suggested to solve the problem</p><ul><li><strong>Catch errors while using values fetched from localstorage</strong> In <code>useEffect</code> fetching the profile value, check if the current data schema is the latest one. If not, remove the key-value from Local Storage and re-fetch from the Database. We have a simpler solution than this.</li><li><strong>Kill Local Storage:</strong> Remove Local Storage completely. Using Local Storage, the performance increase is apparent, this issue could be fixed with simpler solution without compromising on performance.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/felvin-search/docs/edit/master/docs/incident-reports/2021-08-13-localstorage-schema-error.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/team-docs/felvin.com/deployment-runbook"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Deployment runbook</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-was-the-problem" class="table-of-contents__link">What was the problem?</a></li><li><a href="#why-did-it-happen" class="table-of-contents__link">Why did it happen?</a></li><li><a href="#how-did-we-fix-it" class="table-of-contents__link">How did we fix it?</a></li><li><a href="#lessons-and-thoughts" class="table-of-contents__link">Lessons and thoughts</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About us</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/company/about-us">About</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/FelvinSearch" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.felvin.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/felvin-search/instant-apps" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub (Instant Apps)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022</div></div></div></footer></div>
<script src="/assets/js/runtime~main.faae58a7.js"></script>
<script src="/assets/js/main.25343b50.js"></script>
</body>
</html>