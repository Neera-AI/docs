<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HHC5D43J97"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-HHC5D43J97",{anonymize_ip:!0})</script><title data-react-helmet="true">Supertokens for user authentication | Felvin Search Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.felvin.com/decisions/supertokens_for_auth"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Supertokens for user authentication | Felvin Search Documentation"><meta data-react-helmet="true" name="description" content="Decision"><meta data-react-helmet="true" property="og:description" content="Decision"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.felvin.com/decisions/supertokens_for_auth"><link data-react-helmet="true" rel="alternate" href="https://docs.felvin.com/decisions/supertokens_for_auth" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.felvin.com/decisions/supertokens_for_auth" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0c1eb2ef.css">
<link rel="preload" href="/assets/js/runtime~main.769cf12e.js" as="script">
<link rel="preload" href="/assets/js/main.9ac4c1ca.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/favicon-32x32.png" alt="Felvin Search logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/favicon-32x32.png" alt="Felvin Search logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Felvin Search</b></a><a class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a href="https://blog.felvin.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://felvin.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>felvin.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Features</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/overview">Instant Apps</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/profiles/overview">Profiles</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Instant Apps</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/marketplace">Marketplace</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Company</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/about-us">About us</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/vision">Vision</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/mission">Mission</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/careers">Careers</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Events</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/events/hackathon">Instant Apps Hackathon</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Team Docs</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/team-documentation">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/team-docs/tutorials">Tutorial</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Decisions</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/decisions/public_documentation">Public Engineering Documentation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/decisions/supertokens_for_auth">Supertokens for user authentication</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/decisions/styled_components_for_css">Styled components</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Processes</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">RFCs</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">felvin.com</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Incident Reports</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Supertokens for user authentication</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="decision"></a>Decision<a class="hash-link" href="#decision" title="Direct link to heading">#</a></h2><p>We will use Supertokens as our third party authentication tool.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="date"></a>Date<a class="hash-link" href="#date" title="Direct link to heading">#</a></h2><p>14th May 2021</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="context"></a>Context<a class="hash-link" href="#context" title="Direct link to heading">#</a></h2><ul><li>We needed to add user authentication so that users can save changes to their search profiles.</li><li>I (Harsh) have implemented Auth before at Project Mojo and we know that auth is tricky. It doesn&#x27;t make sense to write your own auth.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="factors"></a>Factors<a class="hash-link" href="#factors" title="Direct link to heading">#</a></h2><ul><li>Stability: The third party system shouldn&#x27;t break randomly.</li><li>Ease of Use: If we are using a third party tool, it should actually make our job easy.</li><li>Are there Vendor Lock In: We should be able to move away from a tool if it is not working for us anymore.</li></ul><p>Why Supertokens</p><ul><li>Most important factor: We don&#x27;t have vendor lockin with them.</li><li>They are open source and we can always choose to run supertokens on our hosted instance.</li><li>They are very new, so they score low on ease of use and stability. Though the founders are very active and very supportive in helping us use Supertokens, so that makes up.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="alternatives"></a>Alternatives<a class="hash-link" href="#alternatives" title="Direct link to heading">#</a></h2><ul><li>Auth0</li><li>AWS Cognito</li><li>Firebase Auth</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="expected-outcome"></a>Expected Outcome<a class="hash-link" href="#expected-outcome" title="Direct link to heading">#</a></h2><ul><li>We shoudln&#x27;t have to implement auth over and over. We won&#x27;t see the impact of lack of vendor lock in anytime soon. Maybe we won&#x27;t see it at all, though its a super important factor. When things like vendor lock in hits you, it hits you hard. Say 3 years down the line if Auth0 decides to do something stupid, like heavily increase the pricing, we&#x27;ll have an easy way to move away. Such things can be real bad.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="actual-outcome"></a>Actual Outcome<a class="hash-link" href="#actual-outcome" title="Direct link to heading">#</a></h2><p>To be seen</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="1-month-review"></a>1 month review<a class="hash-link" href="#1-month-review" title="Direct link to heading">#</a></h3><p>The move to Supertokens has been pretty positive till now. There were numerous times we faced issues/bugs which were promptly addressed and fixed after discussions on Supertokens discord.</p><p>The following are the issues we discussed on their discord server and how they were solved.</p><ul><li><p>Endless refresh tokens being sent (17/5/2021)</p><p><strong>Issue</strong></p><p>Due to some reason, a lot of requests to refresh tokens was being sent to <code>/refresh</code></p><p><strong>Solution</strong></p><p>This problem was due to cookies not being set in the frontend, which in turn resulted in these endless refresh tokens requests. The main reason why the cookies weren&#x27;t getting set was because all the requests were going to <code>neera.ai/auth</code> which should have been going to <code>neera.ai/api/auth</code>.</p><p>This was fixed by adding <code>/api/auth</code> in <code>apiBasePath</code> in both Frontend and Backend.</p></li><li><p>Having multiple domains (not sub-domains) as the <code>websiteDomain</code> (21/5/2021)</p><p><strong>Issue</strong></p><p>In an attempt to have login and signups on other domains than production, there was the need of enabling Supertokens on netlify deploy previews as well as <code>beta.neera.ai</code>. The issue being, that while one can allow the deploy previews, by using a RegEx, and beta.neera.ai through CORS using an array. One cannot do the same in Supertokens init.</p><p><strong>Solution</strong></p><p>A solution of access the deploy preview domain using Netlify in built environment variables was suggested by the adming on the discord server. This was suggested as one couldn&#x27;t pass a RegEx. This proved to rather tricky and not worth the effort that had to be put in or had already been put in.</p><p>We later changed the <code>websiteDomain</code> based on the <code>process.env</code> for <code>beta.neera.ai</code>, this resulted in us being able to use things like sign up and sign in on both the production as well as the beta version. We decided on keeping the Netlify deploy previews only to check changes in UI.</p></li><li><p>Connecting to Supertokens DB (1/6/2021)</p><p><strong>Issue</strong></p><p>While trying to make a CSV with the emails of all the users who had signed up on Neera we realized how we only store the userId, which is a random string generated by Supertokens, in our main DB. The emails themselves are stored directly on Supertokens DB but there wasn&#x27;t any mention on how to connect to that DB and dump all the data into a CSV in their documentation. Nor was there any similar option on their dashboard.</p><p><strong>Solution</strong></p><p>One doesn&#x27;t have to host Supertokens and can use it directly out of the box for free, till they have less than 5000 registered users. This is called the managed service. There is also the option of paying them for using the managed service once we cross that number or hosting Supertokens on a server of our own and using it for free.</p><p>It turned out that till one is using the managed service, they cannot connect to the Supertokens Database storing the data. This was solved by Supertokens team by giving the option of downloading the CSV on their dashboard. After they confirmed that a CSV would fulfill our needs, the released the feature in 2 days!</p></li><li><p>Supertokens Cookies not getting attached to pocket and notion requests</p><p><strong>Issue</strong></p><p>In order to store the access tokens of specific users in the main database, we had to indetify the userId of the user in the backend. This can be easily done as Supertokens attaches cookies to all the requests from frontend to backend. But for some reason, they weren&#x27;t getting attached to any requests written for the plugins.</p><p><strong>Solution</strong></p><p>We weren&#x27;t able to figure out why exactly this was happening, as there were numerous reasons this could have happened. While writing code to send userId from the frontend itself, the cookies started getting sent with the requests.</p></li><li><p>1Password not working on Sign Up page (21/6/2021)</p><p><strong>Issue</strong></p><p>During the meeting with KK we saw how 1Password wasn&#x27;t working, which is something he heavily depends on for managing his passwords.</p><p><strong>Solution</strong></p><p>This was said to be due to use of ShadowDOM, which has been disabled while styling the sign up page. <strong>Still needs to checked whether the issue is fixed or not</strong>.</p></li><li><p>Overriding components in Sign up page (1/7/2021)</p><p><strong>Issue</strong></p><p>The custom styling wasn&#x27;t getting applied to the signup form.</p><p><strong>Solution</strong></p><p>The issue got fixed by updating to a newer version of <code>supertokens-auth-react</code>. This also led to finding a bug in their new version, which prevented us to have an empty providers array in our <code>init()</code> function. I temporarily fixed it by GitHub, and removed it after a new release was made a few hours later.</p></li><li><p>Default scope not getting overwritten after providing other scope for in built provider (9/7/2021)</p><p><strong>Issue</strong></p><p>By default the GitHub sign up asks for the <code>user</code> scope, which also asks for write access to personal information on GitHub. This is unnecessary for a simple OAuth and may prevent people from signing up with GitHub.</p><p>Even after specifing other scopes, the default scope remained <code>user</code>.</p><p><strong>Solution</strong></p><p>This is an <a href="https://github.com/supertokens/supertokens-node/issues/148" target="_blank" rel="noopener noreferrer">open issue on supertokens</a>, they are going to fix this in the next release but till then we can make a custom GitHub provider, the code for the same has been provided on their discord server.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="6-month-review"></a>6 month review<a class="hash-link" href="#6-month-review" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="2-year-review"></a>2 year review<a class="hash-link" href="#2-year-review" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="5-year-review"></a>5 year review<a class="hash-link" href="#5-year-review" title="Direct link to heading">#</a></h3></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/felvin-search/docs/edit/master/docs/decisions/supertokens_for_auth.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/decisions/public_documentation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Public Engineering Documentation</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/decisions/styled_components_for_css"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Styled components Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#decision" class="table-of-contents__link">Decision</a></li><li><a href="#date" class="table-of-contents__link">Date</a></li><li><a href="#context" class="table-of-contents__link">Context</a></li><li><a href="#factors" class="table-of-contents__link">Factors</a></li><li><a href="#alternatives" class="table-of-contents__link">Alternatives</a></li><li><a href="#expected-outcome" class="table-of-contents__link">Expected Outcome</a></li><li><a href="#actual-outcome" class="table-of-contents__link">Actual Outcome</a><ul><li><a href="#1-month-review" class="table-of-contents__link">1 month review</a></li><li><a href="#6-month-review" class="table-of-contents__link">6 month review</a></li><li><a href="#2-year-review" class="table-of-contents__link">2 year review</a></li><li><a href="#5-year-review" class="table-of-contents__link">5 year review</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About us</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/company/about-us">About</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/FelvinSearch" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.felvin.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/felvin-search/instant-apps" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub (Instant Apps)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022</div></div></div></footer></div>
<script src="/assets/js/runtime~main.769cf12e.js"></script>
<script src="/assets/js/main.9ac4c1ca.js"></script>
</body>
</html>