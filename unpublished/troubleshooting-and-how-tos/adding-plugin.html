<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HHC5D43J97"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-HHC5D43J97",{anonymize_ip:!0})</script><title data-react-helmet="true">Adding a Plugin to Felvin | Felvin Search Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.felvin.com/unpublished/troubleshooting-and-how-tos/adding-plugin"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Adding a Plugin to Felvin | Felvin Search Documentation"><meta data-react-helmet="true" name="description" content="This document explains how to add a third-party app search plugin like Pocket, Notion to Felvin Search. This enables users to search documents present in these apps directly via Felvin. For every plugin, a new Github Repository must be made. Once you have decided on the app, whose search you want to include follow these steps"><meta data-react-helmet="true" property="og:description" content="This document explains how to add a third-party app search plugin like Pocket, Notion to Felvin Search. This enables users to search documents present in these apps directly via Felvin. For every plugin, a new Github Repository must be made. Once you have decided on the app, whose search you want to include follow these steps"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.felvin.com/unpublished/troubleshooting-and-how-tos/adding-plugin"><link data-react-helmet="true" rel="alternate" href="https://docs.felvin.com/unpublished/troubleshooting-and-how-tos/adding-plugin" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.felvin.com/unpublished/troubleshooting-and-how-tos/adding-plugin" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0c1eb2ef.css">
<link rel="preload" href="/assets/js/runtime~main.65bac1d5.js" as="script">
<link rel="preload" href="/assets/js/main.9ac4c1ca.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/favicon-32x32.png" alt="Felvin Search logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/favicon-32x32.png" alt="Felvin Search logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Felvin Search</b></a><a class="navbar__item navbar__link" href="/">Docs</a><a href="https://blog.felvin.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://felvin.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>felvin.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Adding a Plugin to Felvin</h1></header><p>This document explains how to add a third-party app search plugin like Pocket, Notion to Felvin Search. This enables users to search documents present in these apps directly via Felvin. For every plugin, a new Github Repository must be made. Once you have decided on the app, whose search you want to include follow these steps</p><header><h1>1. Implementing OAuth</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="logistical-guidelines"></a>Logistical Guidelines:<a class="hash-link" href="#logistical-guidelines" title="Direct link to heading">#</a></h2><p>Since to access the documents authentication is required, you need to include the app&#x27;s OAuth in Felvin. There are 2 ways to include the app&#x27;s OAuth in Felvin</p><ul><li><p><strong>Use a Library</strong>: There are some libraries which provide a OAuth for a large number of parties(<a href="https://github.com/simov/grant#callback-session" target="_blank" rel="noopener noreferrer">ref</a>) or sometime you can find app-specific OAuth libraries(<a href="https://www.npmjs.com/package/googleapis" target="_blank" rel="noopener noreferrer">ref</a>). Such libraries if properly implemented complete the job in few lines of code.</p><p>  But sometimes these libraries, like <a href="https://github.com/simov/grant#callback-session" target="_blank" rel="noopener noreferrer">this</a> one, are not suitable for architecture where frontend and backend are decoupled, like in our case. They work well when Server-side code also has the job of service frontend pages, like in the case of Flask with Jinja templates. Instead of trying hacks to complete the job with hacks, it is better to look for an alternative.</p></li><li><p><strong>Implement OAuth from Scratch</strong>: If you have a basic understanding of OAuth Protocol, implementing OAuth from Scratch is not a scary thing as it sounds. Almost all parties follow the <a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_blank" rel="noopener noreferrer">standard OAuth</a> flow. Few follow a variant of the standard, that too with minor changes.</p><p>  The advantage here is that you have control over every step. You can design the flow as your requirements. You will have better clarity on the flow of requests especially in a situation like Felvin, where there are 2 backends - plugin, Felvin Backend.</p><p>  But if implementing from scratch is too complicated, and there is a neat alternative library using a library can be more beneficial. For example, Google&#x27;s OAuth flow is too complicated and there is an official OAuth library by Google to simplify the job. Hence, the Google drive plugin was written using the official <a href="https://www.npmjs.com/package/googleapis" target="_blank" rel="noopener noreferrer">googleapis npm</a> library.</p><p>  <strong>Some important points to be kept in mind. The following points assume that you have a basic understanding of OAuth. If not, watch this short <a href="https://youtu.be/CPbvxxslDTU" target="_blank" rel="noopener noreferrer">YouTube video</a>:</strong></p><ul><li><p>Each app gives you a Client ID and a Client Secret. While Client ID is required on the frontend, for the user to give Felvin access, <strong>Client Secret should not be exposed in any case</strong>. If someone has both Felvin integrations Client ID and Client Secrets, they can do things like sending too many improper requests, which can lead to our integration getting banned.</p><p>  Hence, requests involving Client Secret should be made from plugin only rather than the frontend.</p></li><li><p>Change Redirect URIs accordingly when the app&#x27;s search service is in production. For most of the apps, the Redirect URI needs to be changed at 2 places - in the code, settings of the app.</p></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="technical-guidelines"></a>Technical Guidelines:<a class="hash-link" href="#technical-guidelines" title="Direct link to heading">#</a></h2><p>Here is the flow of a third party app&#x27;s service </p><ul><li><p>User selects the tab, say notion, which he/she wants to search</p></li><li><p>Once the user enters the search query, Frontend checks if the app&#x27;s access token is present in browser&#x27;s localstorage or not.</p><p>   Tokens are stored in the browser in the following format</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;tokens&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;app_name1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token string" style="color:#e3116c">&quot;access_token&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;app_name2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token string" style="color:#e3116c">&quot;access_token&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><p>If the relevant app&#x27;s access token is not found in localStorage, the frontend makes a request to Felvin Backend to check if the app&#x27;s access token is present in DB.</p></li><li><p>Felvin Backend returns a JSON of the same above format, saved in the <code>access_tokens</code> column. The frontend saves the JSON in localStorage and checks if the app&#x27;s access token is present or not. (Note that only strings can be saved in localStorage. Hence the JSON is stringified using <code>JSON.stringfy</code> before saving in localStorage. And while accessing the tokens, it is parsed using <code>JSON.parse</code>)</p></li><li><p>If the access token is access token is still not found, it means the user has not yet completed OAuth with the app.</p></li><li><p>The following are the steps for the user to complete OAuth. Note the process can differ based on the application. But the steps on the user&#x27;s side will almost always remain same</p><ol><li><p>User clicks on the button <code>Sign In with the APP_NAME</code>.</p></li><li><p>On clicking the button, the page redirects to the app&#x27;s page. The user is asked to give access to Felvin&#x27;s integration.</p></li><li><p>Once the user gives access, the page is redirected to the Redirect URI, registered in the app&#x27;s settings and in the code.</p></li><li><p>As per standard OAuth, the Redirect URI contains a <code>code</code> in query parameters.</p></li><li><p>The callback component(the component at Redirect URI) in the frontend sends the <code>code</code> to the plugin service.</p></li><li><p>The plugin service sends the <code>code</code> to the app&#x27;s relevant OAuth API and receives the <code>access token</code>. This <code>access token</code> is used to access the user&#x27;s documents in the app.</p></li><li><p>The plugin service sends <code>access token</code> to the Frontend.</p></li><li><p>Frontend saves the <code>access token</code> in its localStorage and sends it Felvin Backend to update the <code>access token</code> in the Felvin DB.</p><header><h1>2. Searching the documents</h1></header><p>There are 2 ways to implement search.</p></li></ol><ul><li><p><strong>Using the app&#x27;s Search APIs:</strong> This is preferred if</p><ul><li><p>the Rate Limit of the API is not too strict</p></li><li><p>the search results provided by API are good.</p><p>A request can be made directly from the frontend or via the plugin service to the app&#x27;s search API. </p></li></ul></li><li><p><strong>Using Meili Search:</strong> A Meili Search DB is connected to a plugin service. The app&#x27;s documents are stored in Meili Search DB. The documents can be indexed via the user&#x27;s access token.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">So when a user enters the query, the access token is sent to the plugin service. The plugin service returns the search results via Meili Search library APIs.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Note that the documents in Meili Search DB need to be updated. To achieve that, a cronjob can be set up, which fetches the latest documents of all users using the access tokens. </span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">To setup a cronjob:</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">- Write an endpoint on the plugin service, which when hit, updates documents of all the users in Meili Search DB. (Ex: `/cronjob` endpoint in [this](https://github.com/felvin-search/pocket-search-api/blob/master/server/server.js) file)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">- Make a request to the endpoint periodically via Github Actions. ([Example](https://github.com/felvin-search/pocket-search-api/blob/master/.github/workflows/cronjob.yml))</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Through this, cronjob can be monitored via the web, instead of having to check the server. Also make sure that you don&#x27;t expose the DB. The DB must be accessed only by the plugin service.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><header><h1>Adding Docs</h1></header><p>Once everything is working well, add the following in the README of the repo </p></li><li><p>Endpoints documentation - For each endpoint mention the HTTP method, data to be sent, response format.</p></li><li><p>Auth flow - explaining how a user completes OAuth</p></li><li><p>Search flow - Explaining how search results are obtained - via the app&#x27;s search API or Meili Search. If Meili Search is used, explain how the cronjob is set up. Link necessary files for clarity.</p></li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/felvin-search/docs/edit/master/docs/unpublished/troubleshooting-and-how-tos/adding-plugin.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#logistical-guidelines" class="table-of-contents__link">Logistical Guidelines:</a></li><li><a href="#technical-guidelines" class="table-of-contents__link">Technical Guidelines:</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About us</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/company/about-us">About</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/FelvinSearch" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.felvin.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/felvin-search/instant-apps" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub (Instant Apps)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022</div></div></div></footer></div>
<script src="/assets/js/runtime~main.65bac1d5.js"></script>
<script src="/assets/js/main.9ac4c1ca.js"></script>
</body>
</html>