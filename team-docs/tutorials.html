<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HHC5D43J97"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-HHC5D43J97",{anonymize_ip:!0})</script><title data-react-helmet="true">Tutorial | Felvin Search Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.felvin.com/team-docs/tutorials"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Tutorial | Felvin Search Documentation"><meta data-react-helmet="true" name="description" content="NOTE: If you are fairly new to Kubernetes, it should take at least 1-2 days of learning the new concepts as well as playing/experimenting with a cluster and gaining confidence."><meta data-react-helmet="true" property="og:description" content="NOTE: If you are fairly new to Kubernetes, it should take at least 1-2 days of learning the new concepts as well as playing/experimenting with a cluster and gaining confidence."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.felvin.com/team-docs/tutorials"><link data-react-helmet="true" rel="alternate" href="https://docs.felvin.com/team-docs/tutorials" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.felvin.com/team-docs/tutorials" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0c1eb2ef.css">
<link rel="preload" href="/assets/js/runtime~main.65bac1d5.js" as="script">
<link rel="preload" href="/assets/js/main.9ac4c1ca.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/favicon-32x32.png" alt="Felvin Search logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/favicon-32x32.png" alt="Felvin Search logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Felvin Search</b></a><a class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a href="https://blog.felvin.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://felvin.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>felvin.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Features</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/overview">Instant Apps</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/profiles/overview">Profiles</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Instant Apps</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/instant-apps/marketplace">Marketplace</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Company</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/about-us">About us</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/vision">Vision</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/mission">Mission</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/company/careers">Careers</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Events</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/events/hackathon">Instant Apps Hackathon</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Team Docs</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/team-documentation">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/team-docs/tutorials">Tutorial</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Decisions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Processes</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">RFCs</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">felvin.com</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Incident Reports</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tutorial</h1></header><blockquote><p>NOTE: If you are fairly new to Kubernetes, it should take at least 1-2 days of learning the new concepts as well as playing/experimenting with a cluster and gaining confidence.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="goal-deploy-a-new-felvincom-website-using-kubernetes-on-aws"></a>Goal: Deploy a new felvin.com website using Kubernetes on AWS<a class="hash-link" href="#goal-deploy-a-new-felvincom-website-using-kubernetes-on-aws" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="0-prerequisite"></a>0. Prerequisite<a class="hash-link" href="#0-prerequisite" title="Direct link to heading">#</a></h3><p>Kubernetes.io has a nice tutorial which uses a <code>minikube</code> cluster (kubernetes cluster on your laptop) and teaches the basic concepts needed for our purposes. See <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/tutorials/kubernetes-basics</a></p><p>After the tutorial, you should be able to understand the following Kubernetes resources</p><ul><li>Cluster</li><li>Control Pane</li><li>Nodes</li><li>Deployment</li><li>Pods</li><li>Service (and its 4 major types ClusterIP, NodePort, LoadBalancer, ExternalName)</li><li>Labels and Selectors</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="1-create-a-kubernetes-cluster"></a>1. Create a Kubernetes cluster<a class="hash-link" href="#1-create-a-kubernetes-cluster" title="Direct link to heading">#</a></h3><blockquote><p>NOTE: To avoid polluting VPC networks (as they have a max quote per region), we are going to use the <code>ap-south-1</code> region.</p></blockquote><p>Follow the AWS’s tutorial to create a new Kubernetes cluster on EKS. EKS is a service provided by AWS which they call “managed Kubernetes cluster”. Google Cloud and other providers do the same. See what is EKS.</p><p>Steps: <a href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html</a></p><blockquote><p>NOTE: Use Managed nodes instead of Fargate. Managed nodes use actual EC2 instances. Fargate is serverless and does not provide all the controls we should ideally have e.g. sshing into the server and looking around.</p></blockquote><blockquote><p>NOTE: Make sure your laptop has the right aws credentials. Install the aws cli <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html</a> and run aws configure <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html</a> .</p></blockquote><p>This will take several minutes (~20). You can see your new cluster in the EKS dashboard. <a href="https://console.aws.amazon.com/eks/home" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/eks/home</a> </p><p>At this point you should be able to see all the system pods running in the cluster. Pods like core-dns are used for internal service discovery, aws-node are used for storing AWS IAM groups who have authorization to access the cluster, etc.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="2-create-an-ecr-repository-to-store-docker-images"></a>2. Create an ECR repository (to store docker images)<a class="hash-link" href="#2-create-an-ecr-repository-to-store-docker-images" title="Direct link to heading">#</a></h3><p>We need an internal repository where we can store our Docker images. We will then use this image to create a kubernetes Deployment.</p><p>Go to <a href="https://ap-south-1.console.aws.amazon.com/ecr/repositories?region=ap-south-1" target="_blank" rel="noopener noreferrer">https://ap-south-1.console.aws.amazon.com/ecr/repositories?region=ap-south-1</a> and create a new private repository.</p><p>Note the URI of the repository e.g. <code>&lt;id&gt;.dkr.ecr.ap-south-1.amazonaws.com/&lt;repository_name&gt;</code>, we’ll need it later.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="3-create-and-push-the-image"></a>3. Create and push the image<a class="hash-link" href="#3-create-and-push-the-image" title="Direct link to heading">#</a></h3><blockquote><p>Note: Make sure you have Docker running.</p></blockquote><p>Clone the <a href="https://github.com/felvin-search/felvin.com" target="_blank" rel="noopener noreferrer">https://github.com/felvin-search/felvin.com</a> repository and run <code>yarn install</code>. Now create a docker image by running</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">docker build -t &lt;account-id&gt;.dkr.ecr.ap-south-1.amazonaws.com/&lt;repository_name&gt;:latest -f docker/Dockerfile .</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now authenticate against the ECR repository by using <code>aws</code> command here <a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/getting-started-cli.html#cli-authenticate-registry" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/AmazonECR/latest/userguide/getting-started-cli.html#cli-authenticate-registry</a> </p><p>Let’s push the image! Check if you can see the image in the repository using the AWS console.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">docker push &lt;account-id&gt;.dkr.ecr.ap-south-1.amazonaws.com/&lt;repository_name&gt;:latest</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="4-create-required-secrets-object-for-environment-variables"></a>4. Create required Secrets object for environment variables<a class="hash-link" href="#4-create-required-secrets-object-for-environment-variables" title="Direct link to heading">#</a></h3><p>Before we create the deployment, we need to ensure that the environment variables the pods need are ready.</p><p>Follow the steps at <a href="https://developers.google.com/custom-search/v1/introduction" target="_blank" rel="noopener noreferrer">https://developers.google.com/custom-search/v1/introduction</a> to get a google search api key and a context key (which is actually the cx parameter / search engine ID). Once you have them, run</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic google-keys --from-literal=GOOGLE_SEARCH_API_KEY=XXXX --from-literal=GOOGLE_SEARCH_CONTEXT_KEY=XXXX</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>Note: Make sure to toggle &quot;search the whole web&quot; from the Google search console app settings to enable searching the whole web instead of custom websites.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="5-create-a-deployment"></a>5. Create a deployment<a class="hash-link" href="#5-create-a-deployment" title="Direct link to heading">#</a></h3><p>Now let’s create a kubernetes deployment using the docker image we pushed.</p><blockquote><p>Note: This is the first time we are interacting with the cluster manually. The two main ways of doing anything are <code>kubectl &lt;command chain&gt;</code> and <code>kubectl apply -f &lt;a yaml file&gt;</code>. Using a YAML file is good for creating things declaratively, so that they can be shared later.</p></blockquote><p>Update the image url in the <code>deploy/deployment-production.yaml</code>: ​​<a href="https://github.com/felvin-search/felvin.com/blob/master/deploy/deployment-production.yaml#L19" target="_blank" rel="noopener noreferrer">https://github.com/felvin-search/felvin.com/blob/master/deploy/deployment-production.yaml#L19</a> file with <code>&lt;account-id&gt;.dkr.ecr.ap-south-1.amazonaws.com/&lt;repository_name&gt;:latest</code>.</p><p>Now run</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f deploy/deployment-production.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>Protip - Run <a href="https://github.com/derailed/k9s" target="_blank" rel="noopener noreferrer">k9s</a> in a separate terminal and see the new pods getting created live.</p></blockquote><p>In a few minutes, the new pods corresponding to the deployment should be up and running.</p><blockquote><p>Protip: Use <code>kubectl get events --sort-by=&#x27;.metadata.creationTimestamp&#x27; -A</code> to see logs from the
Cluster.</p></blockquote><blockquote><p>Note: If there are any errors, you can also delete the deployment using <code>kubectl delete -f deploy/deployment-production.yaml</code></p></blockquote><p>Few notes on the YAML file</p><ul><li>Any kubernetes resource is uniquely determined by the kind and metadata.name fields.
metadata.namespace can also be provided but it’s <code>default</code> by default.</li><li>This YAML file is describing a K8S resource of Deployment kind with name felvin-search-prod</li><li><code>labels.app</code> is known as a selector. Providing atleast one selector is important to target the pods associated with this deployment e.g. for getting logs from the pods or creating a service to direct the network to the pods, etc.</li><li><code>spec.replicas</code> is the number of pods this deployment should maintain</li><li><code>spec.spec.containers</code> is telling the deployment to create the pods using the specified container image</li></ul><blockquote><p>Protip - We can get any Kubernetes resource (e.g. deployment) declaratively in a YAML file as well. (Or a JSON. Kubernetes as a REST API for interacting with the cluster). Try running <code>kubectl get deployment/felvin-search-prod -o yaml</code></p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="6-port-forward-to-a-pod"></a>6. Port forward to a pod<a class="hash-link" href="#6-port-forward-to-a-pod" title="Direct link to heading">#</a></h3><p>If you see the new pods for the deployment and their status as “Running” in the k9s window, let’s see if the pods are really ready!</p><p>On k9s, use <code>shift+f</code> to port forward to one of the two pods we created. The container port is <code>80</code> and you should use <code>3000</code> on your localhost (to escape CORS errors: <a href="https://github.com/felvin-search/felvin.com/blob/master/packages/backend/index.ts#L18" target="_blank" rel="noopener noreferrer">https://github.com/felvin-search/felvin.com/blob/master/packages/backend/index.ts#L18</a>).</p><p>Now if you open http://localhost:3000 you should be able to see the site up and running!</p><blockquote><p>Protip: You can look at the logs from both the pods by using <code>kubectl logs -f deployment/felvin-search-prod</code></p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="7-create-a-service"></a>7. Create a service<a class="hash-link" href="#7-create-a-service" title="Direct link to heading">#</a></h3><p>We will now create a Kubernetes service to start accepting traffic into our deployment pods. Kubernetes has a nice <code>expose</code> command to create a service which exposes a deployment. Run</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl expose deployment felvin-search-prod --type=LoadBalancer --name=felvin-search</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This is going to create a service of type LoadBalancer called <code>felvin-search</code> which will be able to accept traffic and distribute it to the pods of our <code>felvin-search-prod</code> deployment.</p><p>Now run <code>kubectl get service/felvin-search -o wide</code> and you should be able to see a public URL in the <code>EXTERNAL-IP</code> column.</p><p>The AWS LoadBalancer (aka ALB) can also be seen in the <a href="https://ap-south-1.console.aws.amazon.com/ec2/v2/home?region=ap-south-1#LoadBalancers:sort=loadBalancerName" target="_blank" rel="noopener noreferrer">AWS console</a>.</p><blockquote><p>Protip: As always, you can also get the full YAML file for this service for future reference <code>kubectl get service/felvin-search -o yaml</code></p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="8-set-a-cname-record-pointing-to-the-host"></a>8. Set a CNAME record pointing to the host<a class="hash-link" href="#8-set-a-cname-record-pointing-to-the-host" title="Direct link to heading">#</a></h3><p>Once logged into Cloudflare, go to the DNS section of felvin.com. Add a new CNAME record with a name which is a subdomain of felvin.com, like beta(.felvin.com), pointing to the <code>EXTERNAL-IP</code> of the load balancer created in the previous step as the target.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="9-delete-everything"></a>9. Delete everything<a class="hash-link" href="#9-delete-everything" title="Direct link to heading">#</a></h3><p>Let’s clean up everything!</p><ul><li>Delete your cluster - <code>eksctl delete cluster --name &lt;cluster name&gt; --region ap-south-1</code></li><li>Delete your ECR repository from the console.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="faqs"></a>FAQs<a class="hash-link" href="#faqs" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="what-happens-when-a-new-pr-is-merged-or-a-new-commit-is-pushed-in-felvincom"></a>What happens when a new PR is merged or a new commit is pushed in felvin.com?<a class="hash-link" href="#what-happens-when-a-new-pr-is-merged-or-a-new-commit-is-pushed-in-felvincom" title="Direct link to heading">#</a></h3><ul><li>The main GitHub action workflow is run. <a href="https://github.com/felvin-search/felvin.com/blob/master/.github/workflows/master.yml" target="_blank" rel="noopener noreferrer">https://github.com/felvin-search/felvin.com/blob/master/.github/workflows/master.yml</a> </li><li>The project at the latest commit is containerized using Docker.</li><li>The image is tagged as <code>latest</code> and the timestamp. It is then pushed into the AWS ECR repository (name is in the workflow file).</li><li>It then updates the image used in the kubernetes deployment to the built image tag. This one command triggers the Deployment Rollout, as it’s called. <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="how-to-configure-what-ec2-instance-size-is-used-for-the-cluster-nodes-and-how-many-of-them"></a>How to configure what EC2 instance size is used for the cluster nodes and how many of them?<a class="hash-link" href="#how-to-configure-what-ec2-instance-size-is-used-for-the-cluster-nodes-and-how-many-of-them" title="Direct link to heading">#</a></h3><p>AWS creates a “Node group” to manage the type of nodes used for the kubernetes cluster. If you open the Cluster page on AWS, <a href="https://console.aws.amazon.com/eks/home?region=us-east-1#/clusters/felvin-cluster" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/eks/home?region=us-east-1#/clusters/felvin-cluster</a> you can see the node group. If you open the node group and click “Edit”, you can see the minimum and maximum number of nodes set in the config. Kubernetes will use this to spin up more nodes if needed for scalability reasons.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="how-to-grant-cluster-access-to-more-people-so-that-they-can-run-kubectl-commands"></a>How to grant cluster access to more people so that they can run kubectl commands?<a class="hash-link" href="#how-to-grant-cluster-access-to-more-people-so-that-they-can-run-kubectl-commands" title="Direct link to heading">#</a></h3><p>Update the names and/or roles in <a href="https://github.com/felvin-search/felvin.com/blob/master/deploy/aws-auth-kube-system.yaml" target="_blank" rel="noopener noreferrer">https://github.com/felvin-search/felvin.com/blob/master/deploy/aws-auth-kube-system.yaml</a> and run kubectl apply -f deploy/aws-auth-kube-system.yaml</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="kubectl-commands-cheatsheet"></a>Kubectl commands cheatsheet<a class="hash-link" href="#kubectl-commands-cheatsheet" title="Direct link to heading">#</a></h2><p>Full <a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/reference/kubectl/cheatsheet</a> </p><ul><li><code>kubectl get svc</code><ul><li>Get all services</li></ul></li><li><code>kubectl get all --all-namespaces</code><ul><li>Get everything in all namespaces (pods, services, deployment, replicasets, etc.)</li></ul></li><li><code>kubectl get all</code><ul><li>Get everything in default namespace</li></ul></li><li><code>kubectl logs -f deployment/felvin-search-prod</code><ul><li>Follow logs of a deployment</li></ul></li><li><code>kubectl apply -f deployment-production.yaml</code></li><li><code>kubectl delete -f deployment-production.yaml</code></li><li><code>kubectl get events --sort-by=&#x27;.lastTimestamp&#x27; -A</code></li><li><code>kubectl get events --sort-by=&#x27;.metadata.creationTimestamp&#x27; -A</code><ul><li>Contains important logs outside of pods, useful for debugging deployments</li></ul></li><li><code>kubectl get &lt;service felvin-search&gt; -o yaml</code><ul><li>Export ANY existing k8s object as yaml, for declarative infra</li></ul></li><li><code>eksctl get cluster</code></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/felvin-search/docs/edit/master/docs/team-docs/tutorials.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/team-documentation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/decisions/public_documentation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Public Engineering Documentation »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#goal-deploy-a-new-felvincom-website-using-kubernetes-on-aws" class="table-of-contents__link">Goal: Deploy a new felvin.com website using Kubernetes on AWS</a><ul><li><a href="#0-prerequisite" class="table-of-contents__link">0. Prerequisite</a></li><li><a href="#1-create-a-kubernetes-cluster" class="table-of-contents__link">1. Create a Kubernetes cluster</a></li><li><a href="#2-create-an-ecr-repository-to-store-docker-images" class="table-of-contents__link">2. Create an ECR repository (to store docker images)</a></li><li><a href="#3-create-and-push-the-image" class="table-of-contents__link">3. Create and push the image</a></li><li><a href="#4-create-required-secrets-object-for-environment-variables" class="table-of-contents__link">4. Create required Secrets object for environment variables</a></li><li><a href="#5-create-a-deployment" class="table-of-contents__link">5. Create a deployment</a></li><li><a href="#6-port-forward-to-a-pod" class="table-of-contents__link">6. Port forward to a pod</a></li><li><a href="#7-create-a-service" class="table-of-contents__link">7. Create a service</a></li><li><a href="#8-set-a-cname-record-pointing-to-the-host" class="table-of-contents__link">8. Set a CNAME record pointing to the host</a></li><li><a href="#9-delete-everything" class="table-of-contents__link">9. Delete everything</a></li></ul></li><li><a href="#faqs" class="table-of-contents__link">FAQs</a><ul><li><a href="#what-happens-when-a-new-pr-is-merged-or-a-new-commit-is-pushed-in-felvincom" class="table-of-contents__link">What happens when a new PR is merged or a new commit is pushed in felvin.com?</a></li><li><a href="#how-to-configure-what-ec2-instance-size-is-used-for-the-cluster-nodes-and-how-many-of-them" class="table-of-contents__link">How to configure what EC2 instance size is used for the cluster nodes and how many of them?</a></li><li><a href="#how-to-grant-cluster-access-to-more-people-so-that-they-can-run-kubectl-commands" class="table-of-contents__link">How to grant cluster access to more people so that they can run kubectl commands?</a></li></ul></li><li><a href="#kubectl-commands-cheatsheet" class="table-of-contents__link">Kubectl commands cheatsheet</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About us</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/company/about-us">About</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/FelvinSearch" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.felvin.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/felvin-search/instant-apps" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub (Instant Apps)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022</div></div></div></footer></div>
<script src="/assets/js/runtime~main.65bac1d5.js"></script>
<script src="/assets/js/main.9ac4c1ca.js"></script>
</body>
</html>